define(["jquery","core/notification","core/str","core/ajax","core/log","core/templates","tool_lp/dialogue"],function(a,b,c,d,e,f,g){var h=function(b,c){this._regionSelector=b,this._userCompetencySelector=c,a(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return h.prototype._handleClick=function(c){var f=a(c.target).closest(this._userCompetencySelector),g=a(f).data("competencyid"),h=a(f).data("courseid"),i=a(f).data("userid");e.debug("Clicked on cell: competencyId="+g+", courseId="+h+", userId="+i);var j=d.call([{methodname:"tool_lp_data_for_user_competency_summary_in_course",args:{userid:i,competencyid:g,courseid:h}},{methodname:"core_competency_user_competency_viewed_in_course",args:{userid:i,competencyid:g,courseid:h}}]);a.when(j[0],j[1]).then(this._contextLoaded.bind(this))["catch"](b.exception)},h.prototype._contextLoaded=function(b){return b.displayuser=!0,M.util.js_pending("report_competency/grading_popup:_contextLoaded"),a.when(c.get_string("usercompetencysummary","report_competency"),f.render("tool_lp/user_competency_summary_in_course",b)).then(function(a,b){return new g(a,b[0],function(){f.runTemplateJS(b[1]),M.util.js_complete("report_competency/grading_popup:_contextLoaded")},this._refresh.bind(this),(!0))}.bind(this))},h.prototype._refresh=function(){var c=a(this._regionSelector),e=c.data("courseid"),f=c.data("moduleid"),g=c.data("userid");return""===f&&(f=0),d.call([{methodname:"report_competency_data_for_report",args:{courseid:e,userid:g,moduleid:f},done:this._pageContextLoaded.bind(this),fail:b.exception}])},h.prototype._pageContextLoaded=function(a){f.render("report_competency/report",a).then(function(a,b){f.replaceNode(this._regionSelector,a,b)}.bind(this))["catch"](b.exception)},h.prototype._regionSelector=null,h.prototype._userCompetencySelector=null,h});